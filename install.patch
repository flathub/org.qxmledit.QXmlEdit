From d3b2e77571fcab99df34683fc80b01ad12bac53b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Matthias=20Mail=C3=A4nder?= <matthias@mailaender.name>
Date: Sat, 13 Aug 2022 14:36:38 +0200
Subject: [PATCH] Install Linux metadata into the correct folders

---
 singleapp/app.pro |  7 +++++++
 src/QXmlEdit.pro  |  8 ++++++++
 src/cconfig.pri   | 22 ++++++++++++++++++++++
 3 files changed, 37 insertions(+)

diff --git a/singleapp/app.pro b/singleapp/app.pro
index 45036167..d95b714f 100644
--- a/singleapp/app.pro
+++ b/singleapp/app.pro
@@ -146,6 +146,12 @@ manual.files = ../doc/QXmlEdit_manual.pdf
 iconInfo.path = $$INST_ICON_DIR
 iconInfo.files = ../install_scripts/environment/icon/qxmledit.png
 
+desktopInfo.path = $$INST_DESKTOP_DIR
+desktopInfo.files = ../install_scripts/environment/desktop/QXmlEdit.desktop
+
+metaInfo.path = $$INST_APPDATA_DIR
+metaInfo.files = ../install_scripts/environment/desktop/QXmlEdit.appdata.xml
+
 #-----------------------------------------------------------
 
 # resources are defined in paths.h
@@ -158,6 +164,7 @@ unix:INSTALLS += snippets
 unix:INSTALLS += styles
 unix:INSTALLS += manual
 unix:INSTALLS += desktopInfo
+unix:INSTALLS += metaInfo
 
 include("../src/allsources.pri")
 
diff --git a/src/QXmlEdit.pro b/src/QXmlEdit.pro
index aaf920b6..f907ab22 100644
--- a/src/QXmlEdit.pro
+++ b/src/QXmlEdit.pro
@@ -437,6 +437,12 @@ manual.files = ../doc/QXmlEdit_manual.pdf
 iconInfo.path = $$INST_ICON_DIR
 iconInfo.files = ../install_scripts/environment/icon/qxmledit.png
 
+desktopInfo.path = $$INST_DESKTOP_DIR
+desktopInfo.files = ../install_scripts/environment/desktop/QXmlEdit.desktop
+
+metaInfo.path = $$INST_APPDATA_DIR
+metaInfo.files = ../install_scripts/environment/desktop/QXmlEdit.appdata.xml
+
 # resources are defined in paths.h
 unix:!macx:DEFINES += UNIX_RESOURCES
 
@@ -448,6 +454,8 @@ unix:INSTALLS += manual
 equals(INSTALL_ICON_ENABLED, "Y") {
     unix:INSTALLS += iconInfo
 }
+unix:INSTALLS += desktopInfo
+unix:INSTALLS += metaInfo
 
 OTHER_FILES += \
     resources/test.xsd \
diff --git a/src/cconfig.pri b/src/cconfig.pri
index 403aee47..aef3e409 100644
--- a/src/cconfig.pri
+++ b/src/cconfig.pri
@@ -34,6 +34,8 @@
 ############################ BEGIN INSTALLATION FOLDERS DECLARATION ###########################################
 
 #message(QXMLEDIT_INST_DATA_DIR = $$(QXMLEDIT_INST_DATA_DIR))
+#message(QXMLEDIT_INST_APPDATA_DIR = $$(QXMLEDIT_INST_APPDATA_DIR))
+#message(QXMLEDIT_INST_DESKTOP_DIR = $$(QXMLEDIT_INST_DESKTOP_DIR))
 #message(QXMLEDIT_INST_DIR = $$(QXMLEDIT_INST_DIR))
 #message(QXMLEDIT_INST_DOC_DIR = $$(QXMLEDIT_INST_DOC_DIR))
 #message(QXMLEDIT_INST_LIB_DIR = $$(QXMLEDIT_INST_LIB_DIR))
@@ -76,6 +78,26 @@ DONTUSE_ICON=$$(QXMLEDIT_NO_ICON)
     message("ICON enabled")
 }
 
+INST_APPDATA_DIR=$$(QXMLEDIT_INST_APPDATA_DIR)
+!isEmpty(QXMLEDIT_INST_APPDATA_DIR) {
+    INST_APPDATA_DIR=$$QXMLEDIT_INST_APPDATA_DIR
+}
+isEmpty(INST_APPDATA_DIR) {
+    INST_APPDATA_DIR = /usr/share/appdata/
+}
+message("Inst app data dir $$INST_APPDATA_DIR")
+
+###########################################
+
+INST_DESKTOP_DIR=$$(QXMLEDIT_INST_DESKTOP_DIR)
+!isEmpty(QXMLEDIT_INST_DESKTOP_DIR) {
+    INST_DESKTOP_DIR=$$QXMLEDIT_INST_DESKTOP_DIR
+}
+isEmpty(INST_DESKTOP_DIR) {
+    INST_DESKTOP_DIR = /usr/share/applications/
+}
+message("Inst desktop data dir $$INST_DESKTOP_DIR")
+
 ###########################################
 
 INST_DIR=$$(QXMLEDIT_INST_DIR)
